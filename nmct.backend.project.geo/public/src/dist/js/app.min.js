function placeMarkerAndPanTo(e,n){new google.maps.Marker({position:e,map:n});n.panTo(e)}function setupSockets(){socket=io.connect(token?"?token="+token:"",{forceNew:!0}),socket.on("time",function(e){console.log("- broadcast: "+e)}).on("authenticated",function(){console.log("- authenticated")}).on("disconnect",function(){console.log("- disconnected")}).on("addshare",function(e){console.log("- add share to map")}).on("shares",function(e){console.log("- get shares: "+e[0].feeling)}).on("unauthorized",function(e){console.log("- unauthorized")})}function connectAnonymous(){post("anonymous",123)}function post(e,n){$.ajax({type:"POST",data:{username:e,password:n},url:"../login"}).done(function(e){token=e.token,setupSockets(),readShares()})}function readShares(){socket.emit("shares")}function showPosition(e){var n=e.coords.latitude,o=e.coords.longitude,t={lat:n,lng:o};placeMarkerAndPanTo(t,map)}function placeMarkerAndPanTo(e,n){new google.maps.Marker({position:e,map:n});n.panTo(e)}!function(){map.initialize("map-canvas");var e=angular.module("app",["ngRoute"]);e.config(function(e,n,o){e.debugEnabled(!0),n.when("/",{controller:"LoginController",controllerAs:"login",templateUrl:"./templates/login.html"}).when("/register",{controller:"RegisterController",controllerAs:"register",templateUrl:"./templates/register.html"}).when("/main",{controller:"MainController",controllerAs:"main",templateUrl:"./templates/main.html"}).otherwise({redirectTo:"/"})})}();var client=function(){var e,n,o,t,a=function(){n=io.connect(e?"?token="+e:"",{forceNew:!0}),n.on("time",function(e){console.log("- broadcast: "+e)}).on("register",function(e){console.log("- register")}).on("authenticated",function(){console.log("- authenticated")}).on("disconnect",function(){console.log("- disconnected")}).on("unauthorized",function(e){console.log("- unauthorized")}).on("addshare",function(e){null!=o&&o(null,e)}).on("addactivity",function(e){null!=t&&t(null,e)})},r=function(e){i("anonymous",Sha1.hash("123"),e)},i=function(n,o,t){$.ajax({type:"POST",contentType:"text/html; charset=UTF-8",data:{username:n,password:o},url:"../login"}).done(function(n){n.error?t(n.error,null):n.token?(e=n.token,localStorage.token=e,a(),t(null,n.user)):t("Unhandeld error",null)})},c=function(e,n,o){i(e,Sha1.hash(n.toString()),o)},s=function(o,t,a,r,i){var c={id:a,name:o,firstname:t,username:a,password:r};n.emit("register",{error:null,user:c,token:e}),i(null,c)},l=function(e){n.on("shares",function(n){e(null,n)}),n.emit("shares",null)},u=function(e){n.on("activities",function(n){e(null,n)}),n.emit("activities",null)},d=function(t,a){var r={error:null,share:t,token:e};null!=a&&(o=a),n.emit("addshare",r)},p=function(o,a){var r={error:null,activity:o,token:e};null!=a&&(t=a),n.emit("addactivity",r)},f=function(e,n){e.isActivity?p(e,n):d(e,n)};return{login:c,register:s,connectAnonymous:r,getShares:l,getActivities:u,sendShareOrActivity:f,receiveAddShare:o,receiveAddActivity:t}}(),Sha1={};Sha1.hash=function(e){e=e.utf8Encode();var n=[1518500249,1859775393,2400959708,3395469782];e+=String.fromCharCode(128);for(var o=e.length/4+2,t=Math.ceil(o/16),a=new Array(t),r=0;t>r;r++){a[r]=new Array(16);for(var i=0;16>i;i++)a[r][i]=e.charCodeAt(64*r+4*i)<<24|e.charCodeAt(64*r+4*i+1)<<16|e.charCodeAt(64*r+4*i+2)<<8|e.charCodeAt(64*r+4*i+3)}a[t-1][14]=8*(e.length-1)/Math.pow(2,32),a[t-1][14]=Math.floor(a[t-1][14]),a[t-1][15]=8*(e.length-1)&4294967295;for(var c,s,l,u,d,p=1732584193,f=4023233417,h=2562383102,m=271733878,g=3285377520,y=new Array(80),r=0;t>r;r++){for(var S=0;16>S;S++)y[S]=a[r][S];for(var S=16;80>S;S++)y[S]=Sha1.ROTL(y[S-3]^y[S-8]^y[S-14]^y[S-16],1);c=p,s=f,l=h,u=m,d=g;for(var S=0;80>S;S++){var v=Math.floor(S/20),T=Sha1.ROTL(c,5)+Sha1.f(v,s,l,u)+d+n[v]+y[S]&4294967295;d=u,u=l,l=Sha1.ROTL(s,30),s=c,c=T}p=p+c&4294967295,f=f+s&4294967295,h=h+l&4294967295,m=m+u&4294967295,g=g+d&4294967295}return Sha1.toHexStr(p)+Sha1.toHexStr(f)+Sha1.toHexStr(h)+Sha1.toHexStr(m)+Sha1.toHexStr(g)},Sha1.f=function(e,n,o,t){switch(e){case 0:return n&o^~n&t;case 1:return n^o^t;case 2:return n&o^n&t^o&t;case 3:return n^o^t}},Sha1.ROTL=function(e,n){return e<<n|e>>>32-n},Sha1.toHexStr=function(e){for(var n,o="",t=7;t>=0;t--)n=e>>>4*t&15,o+=n.toString(16);return o},"undefined"==typeof String.prototype.utf8Encode&&(String.prototype.utf8Encode=function(){return unescape(encodeURIComponent(this))}),"undefined"==typeof String.prototype.utf8Decode&&(String.prototype.utf8Decode=function(){try{return decodeURIComponent(escape(this))}catch(e){return this}}),"undefined"!=typeof module&&module.exports&&(module.exports=Sha1),"function"==typeof define&&define.amd&&define([],function(){return Sha1});var map=function(){"use strict";var e=function(e){};return{initialize:function(n){var o=document.getElementById(n),t={zoom:12,mapTypeControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(o,t),google.maps.event.addDomListener(window,"load",e),google.maps.event.addDomListener(window,"resize",function(){var e=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(e)})}}}(),mapType=function(){"use strict";return{changeMapType:function(e){switch(e){case"hybrid":map.setMapTypeId(google.maps.MapTypeId.HYBRID);break;case"roadmap":map.setMapTypeId(google.maps.MapTypeId.ROADMAP);break;case"satellite":map.setMapTypeId(google.maps.MapTypeId.SATELLITE);break;case"terrain":map.setMapTypeId(google.maps.MapTypeId.TERRAIN);break;default:map.setMapTypeId(google.maps.MapTypeId.ROADMAP)}}}}(),token,socket;$("#login").submit(function(e){e.preventDefault();var n=$("#exampleInputEmail1").val(),o=$("#exampleInputPassword1").val();post(n,o)}),connectAnonymous(),$("#add-share").submit(function(e){socket.emit("addshare",{error:null,share:"test-share",token:token})}),function(){"use strict";if(navigator.geolocation){navigator.geolocation.getCurrentPosition(showPosition)}else showError(error)}();