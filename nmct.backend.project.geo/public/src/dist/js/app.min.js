function placeMarkerAndPanTo(e,n){new google.maps.Marker({position:e,map:n});n.panTo(e)}function setupSockets(){socket=io.connect(token?"?token="+token:"",{forceNew:!0}),socket.on("time",function(e){console.log("- broadcast: "+e)}).on("authenticated",function(){console.log("- authenticated")}).on("disconnect",function(){console.log("- disconnected")}).on("addshare",function(e){console.log("- add share to map")}).on("shares",function(e){console.log("- get shares: "+e[0].feeling)}).on("unauthorized",function(e){console.log("- unauthorized")})}function connectAnonymous(){post("anonymous",123)}function post(e,n){$.ajax({type:"POST",data:{username:e,password:n},url:"../login"}).done(function(e){token=e.token,setupSockets(),readShares()})}function readShares(){socket.emit("shares")}!function(){map.initialize("map-canvas");var e=angular.module("app",["ngRoute"]);e.config(function(e,n,t){e.debugEnabled(!0),n.when("/",{controller:"LoginController",controllerAs:"login",templateUrl:"./templates/login.html"}).when("/register",{controller:"RegisterController",controllerAs:"register",templateUrl:"./templates/register.html"}).when("/main",{controller:"MainController",controllerAs:"main",templateUrl:"./templates/main.html"}).otherwise({redirectTo:"/"})})}();var roadmap=document.getElementById("roadmap"),hybrid=document.getElementById("hybrid"),satellite=document.getElementById("satellite"),terrain=document.getElementById("terrain");roadmap.addEventListener("click",function(){mapType.changeMapType("roadmap")}),hybrid.addEventListener("click",function(){mapType.changeMapType("hybrid")}),satellite.addEventListener("click",function(){mapType.changeMapType("satellite")}),terrain.addEventListener("click",function(){mapType.changeMapType("terrain")});var client=function(){var e,n,t,o,a=function(){n=io.connect(e?"?token="+e:"",{forceNew:!0}),n.on("time",function(e){console.log("- broadcast: "+e)}).on("register",function(e){console.log("- register")}).on("authenticated",function(){console.log("- authenticated")}).on("disconnect",function(){console.log("- disconnected")}).on("unauthorized",function(e){console.log("- unauthorized")}).on("addshare",function(e){null!=t&&t(null,e)}).on("addactivity",function(e){null!=o&&o(null,e)})},r=function(e){i("anonymous",Sha1.hash("123"),e)},i=function(n,t,o){$.ajax({type:"POST",contentType:"text/html; charset=UTF-8",data:{username:n,password:t},url:"../login"}).done(function(n){n.error?o(n.error,null):n.token?(e=n.token,localStorage.token=e,a(),o(null,n.user)):o("Unhandeld error",null)})},c=function(e,n,t){i(e,Sha1.hash(n.toString()),t)},l=function(t,o,a,r,i){var c={id:a,name:t,firstname:o,username:a,password:r};n.emit("register",{error:null,user:c,token:e}),i(null,c)},s=function(e){n.on("shares",function(n){e(null,n)}),n.emit("shares",null)},u=function(e){n.on("activities",function(n){e(null,n)}),n.emit("activities",null)},d=function(o,a){var r={error:null,share:o,token:e};null!=a&&(t=a),n.emit("addshare",r)},p=function(t,a){var r={error:null,activity:t,token:e};null!=a&&(o=a),n.emit("addactivity",r)},m=function(e,n){e.isActivity?p(e,n):d(e,n)};return{login:c,register:l,connectAnonymous:r,getShares:s,getActivities:u,sendShareOrActivity:m,receiveAddShare:t,receiveAddActivity:o}}(),Sha1={};Sha1.hash=function(e){e=e.utf8Encode();var n=[1518500249,1859775393,2400959708,3395469782];e+=String.fromCharCode(128);for(var t=e.length/4+2,o=Math.ceil(t/16),a=new Array(o),r=0;o>r;r++){a[r]=new Array(16);for(var i=0;16>i;i++)a[r][i]=e.charCodeAt(64*r+4*i)<<24|e.charCodeAt(64*r+4*i+1)<<16|e.charCodeAt(64*r+4*i+2)<<8|e.charCodeAt(64*r+4*i+3)}a[o-1][14]=8*(e.length-1)/Math.pow(2,32),a[o-1][14]=Math.floor(a[o-1][14]),a[o-1][15]=8*(e.length-1)&4294967295;for(var c,l,s,u,d,p=1732584193,m=4023233417,f=2562383102,h=271733878,g=3285377520,y=new Array(80),r=0;o>r;r++){for(var v=0;16>v;v++)y[v]=a[r][v];for(var v=16;80>v;v++)y[v]=Sha1.ROTL(y[v-3]^y[v-8]^y[v-14]^y[v-16],1);c=p,l=m,s=f,u=h,d=g;for(var v=0;80>v;v++){var S=Math.floor(v/20),T=Sha1.ROTL(c,5)+Sha1.f(S,l,s,u)+d+n[S]+y[v]&4294967295;d=u,u=s,s=Sha1.ROTL(l,30),l=c,c=T}p=p+c&4294967295,m=m+l&4294967295,f=f+s&4294967295,h=h+u&4294967295,g=g+d&4294967295}return Sha1.toHexStr(p)+Sha1.toHexStr(m)+Sha1.toHexStr(f)+Sha1.toHexStr(h)+Sha1.toHexStr(g)},Sha1.f=function(e,n,t,o){switch(e){case 0:return n&t^~n&o;case 1:return n^t^o;case 2:return n&t^n&o^t&o;case 3:return n^t^o}},Sha1.ROTL=function(e,n){return e<<n|e>>>32-n},Sha1.toHexStr=function(e){for(var n,t="",o=7;o>=0;o--)n=e>>>4*o&15,t+=n.toString(16);return t},"undefined"==typeof String.prototype.utf8Encode&&(String.prototype.utf8Encode=function(){return unescape(encodeURIComponent(this))}),"undefined"==typeof String.prototype.utf8Decode&&(String.prototype.utf8Decode=function(){try{return decodeURIComponent(escape(this))}catch(e){return this}}),"undefined"!=typeof module&&module.exports&&(module.exports=Sha1),"function"==typeof define&&define.amd&&define([],function(){return Sha1});var map=function(){"use strict";var e=function(e){};return{initialize:function(n){var t=document.getElementById(n),o={center:new google.maps.LatLng(50.820301,3.261038),zoom:12,mapTypeControl:!1,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(t,o),google.maps.event.addDomListener(window,"load",e),google.maps.event.addDomListener(window,"resize",function(){var e=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(e)})}}}(),mapType=function(){"use strict";return{changeMapType:function(e){switch(e){case"hybrid":map.setMapTypeId(google.maps.MapTypeId.HYBRID);break;case"roadmap":map.setMapTypeId(google.maps.MapTypeId.ROADMAP);break;case"satellite":map.setMapTypeId(google.maps.MapTypeId.SATELLITE);break;case"terrain":map.setMapTypeId(google.maps.MapTypeId.TERRAIN);break;default:map.setMapTypeId(google.maps.MapTypeId.ROADMAP)}}}}(),token,socket;$("#login").submit(function(e){e.preventDefault();var n=$("#exampleInputEmail1").val(),t=$("#exampleInputPassword1").val();post(n,t)}),connectAnonymous(),$("#add-share").submit(function(e){socket.emit("addshare",{error:null,share:"test-share",token:token})});